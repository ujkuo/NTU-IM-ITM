\documentclass[a4paper]{article}
%The main tex begins from line 188
\usepackage[top = 2.5cm, bottom = 2.5cm, left = 2cm, right = 2cm]{geometry} 
\usepackage{amsmath} % For the usage of \because and \therefore
\usepackage{amssymb}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{etoolbox}
\usepackage{indentfirst}
\usepackage{tabularx}
\usepackage{mathtools}
\usepackage{booktabs}
\usepackage{authblk}
\usepackage[calcwidth]{titlesec}
\usepackage{bookmark}
\usepackage[capitalize]{cleveref}
\usepackage{array}
\usepackage[english]{babel}
\usepackage{enumitem} % For the usage of labeling in enumerate and itemize
%\usepackage[utf8]{inputenc}
%\usepackage{CJKutf8}
\usepackage{xeCJK}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatletter
% Macros for setting basic info
\gdef\@uni{National Taiwan University}
\gdef\@department{Information Management}
\gdef\@me{Yu-Chieh Kuo}

\newcommand{\course}[2][]{
    \ifstrempty{#1}{
        \gdef\shortcourse{#2}
    }{
        \gdef\shortcourse{#1}
    }
    \gdef\@course{#2}
}
\newcommand{\teacher}[1]{\gdef\@teacher{#1}}
\newcommand{\semester}[1]{\gdef\@semester{#1}}
\newcommand{\uni}[1]{\gdef\@uni{#1}}
\newcommand{\department}[1]{\gdef\@department{#1}}
\newcommand{\student}[3][]{
    \ifstrempty{#1}{
        \author{\textbf{#2} \textbf{#3}}
    }{
        \author[#1]{\textbf{#2} \textbf{#3}}
    }
}
\newcommand{\assignment}[2][Homework]{
    \ifstrempty{#2}{
        \gdef\@assignment{#1}
    }{
        \gdef\@assignment{#1 #2}
    }
}

% page style for title page
\fancypagestyle{title}{
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \cfoot{\footnotesize Page {\thepage} of \pageref{LastPage}} 
}
\newcommand{\ujtitle}{
    \thispagestyle{title}
    \noindent\begin{tabularx}{\linewidth}{Xr} % This is a simple tabular environment to align your text nicely 
    {\large \bf{\@course}} \\
    National Taiwan University, \@semester  \\
    \bottomrule % \hline produces horizontal lines.
    \end{tabularx}
    
    \vspace*{0.3cm}

    \begin{center}
        {\huge\bf\textsc{\@assignment}}\\[3mm]
        {\@author}
    \end{center}

    \vspace*{0.3cm}
}
\newcommand{\mymaketitle}{
    \thispagestyle{title}
    \vspace*{-15mm}
    \noindent\begin{tabularx}{\linewidth}{Xr}
                                & \textsl{National Taiwan University} \\
        \large\textbf{\@semester,} & \textsl{Department of \@department}         \\
        \large\textbf{\@course} & \textsl{Prof. \@teacher}\Bstrut\\
        \bottomrule
    \end{tabularx}

    \vspace*{10mm}

    \begin{center}
        {\huge\textsc{\@assignment{}}}\\[6mm]
        {\@author}
    \end{center}

    \vspace*{1cm}
}

% page style for contents
\pagestyle{fancy}
\fancyhf{}
\setlength{\headheight}{13.6pt}
\lhead{\small {\@course}: {\@assignment}}
\rhead{\small {\@me}}
\cfoot{\small {Page {\thepage} of \pageref{LastPage}}} 

% Style for part, section, and subsection
% Part
\titleclass{\part}{straight}
\titleformat{\part}
[display]
{\centering\bfseries}
{\setlength{\titlewidth}{1.5\titlewidth}\large\titleline*[c]{\titlerule[.6pt]}\vspace{3pt}\MakeUppercase{\partname} \thepart}
{0pt}
{\LARGE\itshape}
[{
    \setlength{\titlewidth}{1.5\titlewidth}
    \titleline*[c]{\titlerule*{\mdseries-}}
}]
\titlespacing*{\part}{0pt}{20pt}{20pt}[0pt]

% Problem and subproblem
\setcounter{secnumdepth}{0}
\newcounter{problem}
\newcounter{subproblem}[problem]
\newbool{appendix}
\gdef\problemName{Problem}
\newcommand{\problem}[2][]{
    \setcounter{equation}{0}
    \ifstrempty{#1}{
        \stepcounter{problem}
    }{
        \setcounter{problem}{#1}
    }
    \ifstrempty{#2}{
        \ifbool{appendix}{
            \section{\hspace{-5mm}\problemName{} \Alph{problem}.}
        }{
            \section{\hspace{-5mm}\problemName{} \arabic{problem}}
        }
    }{
        \ifbool{appendix}{
            \section{\hspace{-5mm}\problemName{} \Alpa{problem}: #2}
        }{
            \section{\hspace{-5mm}\problemName{} \arabic{problem}: #2}
        }
    }
}
\newcommand{\subproblem}[2][]{
    \setcounter{equation}{0}
    \ifstrempty{#1}{
        \stepcounter{subproblem}
    }{
        \setcounter{subproblem}{#1}
    }
    \ifstrempty{#2}{
        \ifbool{appendix}{
            \section{\hspace{-2mm}\Alph{problem}.\arabic{subproblem}}
        }{
            \section{\hspace{-2mm}\arabic{problem}.(\alph{subproblem})}
        }
    }{
        \ifbool{appendix}{
            \section{\hspace{-2mm}\Alph{problem}.\arabic{subproblem}. #2}
        }{
            \section{\hspace{-2mm}\arabic{problem}.(\alph{subproblem}) #2}
        }
    }
}

% Appendix
\newcommand{\myAppendix}{
    \setcounter{section}{0}
    \renewcommand{\sectionname}{Appendix}
    \renewcommand{\thesection}{\Alph{section}}
    \renewcommand{\thesubsection}{\Alph{section}.\arabic{subsection}}
    \renewcommand{\perhapscolon}[1]{\perhapsdot{##1}}
}

% Bookmarks
\hypersetup{
    bookmarksnumbered=true
}

% Reference nome for task and subtask
\crefname{section}{\sectionname}{\sectionnamepl}

\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \everymath{\displaystyle}

% commands for spacing
\newcommand{\Tstrut}{\rule{0pt}{4mm}}         % = `top' strut
\newcommand{\Bstrut}{\rule[-2mm]{0mm}{0mm}}   % = `bottom' strut

% Paired Delimiters {}, (), []
\providecommand\given{} % so it exists
\newcommand\SetSymbol[1][]{
   \nonscript\,#1\vert \allowbreak \nonscript\,\mathopen{}}
\DeclarePairedDelimiterX\Set[1]{\lbrace}{\rbrace}%
 { \renewcommand\given{\SetSymbol[\delimsize]} #1 }
\DeclarePairedDelimiterX{\Bkt}[1]{[}{]}{#1}
\DeclarePairedDelimiterX{\Paren}[1]{(}{)}{#1}
\DeclarePairedDelimiterX{\Abs}[1]{\lvert}{\rvert}{#1}
\newcommand{\PR}[1]{\Pr\Bkt*{#1}}
\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}

\newcolumntype{D}{>{$(}l<{)$}}
\newcolumntype{R}{>{\displaystyle}r}
\newcolumntype{C}{>{\displaystyle}c}
\newcolumntype{L}{>{\displaystyle}l}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsfonts}
\usepackage{amsthm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Declare operator and useful math command
\DeclareMathOperator{\EOp}{\mathbb{E}}
\newcommand{\E}[1]{\ensuremath{\EOp\Bkt*{#1}}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\PS}[1]{\mathcal{P}(#1)}
\newcommand{\ve}{\varepsilon}

%\newcommand{\ss}{\subset}
\newcommand{\sse}{\subseteq}

\newcommand{\ie}{\text{ i.e., }}
\newcommand{\st}{\text{ s.t.  }}


% Declare delimiter
\DeclareMathDelimiter{\lVert}
  {\mathopen}{symbols}{"6B}{largesymbols}{"0D}
\DeclareMathDelimiter{\rVert}
  {\mathclose}{symbols}{"6B}{largesymbols}{"0D}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\theoremstyle{plain}
\newtheorem{corollary}{Corollary}
\newtheorem{proposition}{Proposition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setCJKmainfont{思源宋體 TW}
%\setmainfont{思源宋體 TW}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{listings}
\usepackage{xcolor}
%\usepackage{graphicx}
%\usepackage{multirow}
%\usepackage{setspace}
%\usepackage[T1]{fontenc}
%\usepackage[utf8]{inputenc}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=Python,
    aboveskip=3mm,
  belowskip=3mm,
    showstringspaces=false,
  columns=flexible,
    basicstyle={\small\ttfamily},
  numbers=none,
    numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
    commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
    breaklines=true,
  breakatwhitespace=true,
    tabsize=3
}

\begin{document}
%\begin{CJK*}{UTF8}{bsmi}
\course{Introduction of Text Mining}
\semester{Fall 2021}
%\teacher{}
\department{}
\assignment{1}
\date{\today}
\student[$\dagger$]{Yu-Chieh Kuo}{B07611039}
\affil[$\dagger$]{Department of Information Management, National Taiwan University}
\ujtitle
\section{Usage}
\begin{lstlisting}[language=bash]
    cd B07611039
    cp -R /PA1-data .
    mkdir out
    mkdir output
    python -V # Python 3.7.12 in my environment
    pip install sklearn 
    # Requirement: sklearn, numpy, os
    python3 pa1.py
\end{lstlisting}

\section{Result and Explanation}
\subsection{Cosine similarity}
The cosine similarity is 0.19991361508978656.

\subsection{Details}
The equirements of this assignment are sklearn, numpy and os. Check these packages
are installed before execution.

First, I read data into a list and split lines. Then I use the functions in
sklearn package to transform TFIDF vectors.
Note that in the statement, it's mentioned to lowercase words and filter
out English stopwords, I, therefore, use the option in TFidfVectorizer to achieve
the requirement.
Code is represented as below.
\begin{lstlisting}[language=Python]
    TFIDF_vectorizer = TfidfVectorizer(stop_words='english', lowercase=True)
    TFIDF_vectors = TFIDF_vectorizer.fit_transform(data)
    TFIDF_vectors
    # <1095x19130 sparse matrix of type '<class 'numpy.float64'>'
    #    with 200585 stored elements in Compressed Sparse Row format>
\end{lstlisting}

After constructing TFIDF vectors, I write doc1.txt and doc3.txt.
Note that these two documents should represent the amount of terms
and all terms with {\bf non-zero} tf-idf among TFIDV vectors. 
Consequently, the data should be clean. I used to used if-condition
to remove all terms with {\bf 0} tf-idf, but it doesn't make sense too much.
My classmate tells me that it's available in python to check whether the 
value is zero and remove terms automatically. Code is represented as below.
\begin{lstlisting}[language=Python]
    print((TFIDF_vectors.toarray()[0] != 0).sum(), file = f)
    print("t_index,tf-idf", file = f)
    index = np.arange(TFIDF_vectors.shape[1])[(TFIDF_vectors.toarray()[0] != 0)]
    tfidf = (TFIDF_vectors.toarray()[0])[(TFIDF_vectors.toarray()[0] != 0)]
    for t_index, tfidf_value in zip(index, tfidf):
        print(f"{t_index},{tfidf_value}", file = f)
\end{lstlisting}
It follows the same process to make doc1.txt and doc3.txt. The only
difference is the index of TDIFD vectors. To doc1.txt, the index is 0
and 2 otherwise.

Finally, use function to calculate cosine similarity directly.
\begin{lstlisting}[language=Python]
    cosine_similarity(TFIDF_vectors, TFIDF_vectors)[0][1]
\end{lstlisting}
The result is about 0.19991361508978656.


%\end{CJK*}
\end{document}

